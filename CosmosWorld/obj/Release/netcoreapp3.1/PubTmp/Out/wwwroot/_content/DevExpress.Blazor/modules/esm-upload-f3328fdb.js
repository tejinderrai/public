import"./esm-chunk-d81494b9.js";import{ensureElement as e,attachEventToElement as t,addClassNameToElement as n,removeClassNameFromElement as o,detachEventFromElement as i}from"./esm-dom-utils-88a2c0cb.js";import{d as s,r}from"./esm-chunk-fc46b9cc.js";const a=0,u=1,l=2,c=3,f=4,d=5,h=6,p=0;function m(a,u,l,c,f){let d;a=e(a),l=e(l),c=u.buttonCssSelector?document.querySelector(u.buttonCssSelector):e(c),u.dropZoneCssSelector&&(d=document.querySelector(u.dropZoneCssSelector)),l&&s(l),c&&s(c),d&&s(d);let h,p=null,m=null,S=null,E=null;return a.files||(a.files=[]),l&&(u.multiple&&l.setAttribute("multiple",""),u.acceptedFileTypes&&l.setAttribute("accept",u.acceptedFileTypes.join(",")),p=function(e){g(l.files,f,u).then((function(e){y(e,u,a,f),l.value=""}))},t(l,"change",p),c&&(m=function(){l.click()},t(c,"click",m)),d&&(S=function(e){e.preventDefault(),g(function(e,t){const n=[];if(e.items)for(let t=0,o=e.items[t];o;t++,o=e.items[t])"file"===o.kind&&n.push(o.getAsFile());else for(let t=0,o=e.files[t];o;t++,o=e.files[t])n.push(o);return function(e,t){if(!e.length||!t)return e;const n=[],o=function(e){return e.map(e=>e.trim())}(t);for(let t=0,i=e.length;t<i;t++)z(e[t],o)&&n.push(e[t]);return n}(t.multiple?n:[n[0]],t.acceptedFileTypes)}(e.dataTransfer,u),f,u).then((function(e){y(e,u,a,f)})),h(e)},E=function(e){u.dragOverClassName&&n(e.srcElement,u.dragOverClassName),e.preventDefault()},h=function(e){u.dragOverClassName&&o(e.srcElement,u.dragOverClassName)},t(d,"drop",S),t(d,"dragover",E),t(d,"dragleave",h))),r(l,(function(){p&&i(l,"change",p)})),c&&r(c,(function(){i(c,"click",m)})),d&&r(d,(function(){i(d,"drop",S),i(d,"dragover",E),i(d,"dragover",h)})),Promise.resolve("ok")}function g(e,t,n){return new Promise((function(o,i){t.invokeMethodAsync("CreateFileGuids",e.length).then((function(t){const i=[];for(let o=0,s=e[o];s;o++,s=e[o]){const e=S(s,t[o],n);i.push(e)}o(i)}))}))}function S(e,t,n){const o={value:e,fileInfo:{name:e.name,size:e.size,type:e.type,lastModified:1e4*e.lastModified+621355968e9,guid:t},status:n.uploadMode===p?u:a,loadedBytes:0,isFileExtensionValid:E(e,n),isMinSizeValid:I(e,n),isMaxSizeValid:F(e,n),isValid:function(){return this.isFileExtensionValid&&this.isMaxSizeValid&&this.isMinSizeValid},isUploadComplete:function(){return this.loadedBytes>=this.fileInfo.size},loadStart:function(){this.status!==l&&(this.status=l,this.onLoadStart&&this.onLoadStart.call(this))},progress:function(){this.onProgress&&this.onProgress.call(this)},pause:function(){this.status=c,this.onPause&&this.onPause.call(this)},loadEnd:function(){this.isUploadComplete()&&(this.status=f,this.onLoadEnd&&this.onLoadEnd.call(this))},abort:function(){this.status!==d&&(this.status=d,this.request&&this.request.abort(),this.onAbort&&this.onAbort.call(this))},error:function(e){this.status=h,this.onError&&this.onError.call(this,e)}};return o.isValid()&&n.uploadUrl||(o.status=h),o}function E(e,t){const n=t.allowedFileExtensions,o=e.name.substring(e.name.lastIndexOf(".")).toLowerCase();if(0===n.length)return!0;for(let e=0;e<n.length;e++)if(o===n[e].toLowerCase())return!0;return!1}function F(e,t){const n=t.maxFileSize;return!(n>0)||e.size<=n}function I(e,t){const n=t.minFileSize;return!(n>0)||e.size>=n}function z(e,t){return t.some((function(t){if("."===t[0]){if(t=t.replace(".","\\."),e.name.match(new RegExp(t+"$","i")))return!0}else if(t=t.replace("*",""),e.type.match(new RegExp(t,"i")))return!0}))}function y(e,t,n,o){0!==e.length&&(n.files=n.files.concat(e),v(n.files,o),e.forEach((function(e){b(e,t,n,o)})))}function b(e,t,n,o){e&&e.isValid()&&e.status!==a&&e.status!==h&&(!function(e,t){e.onLoadStart=function(){!function(e,t){L("FileUploadStarted",e,t)}(e,t)},e.onProgress=function(){!function(e,t){L("FileProgress",e,t)}(e,t)},e.onAbort=function(){!function(e,t){L("FileUploadAborted",e,t)}(e,t)},e.onPause=function(){!function(e,t){L("FileUploadPaused",e,t)}(e,t)},e.onError=function(n){!function(e,t,n,o,i){i.invokeMethodAsync("FileUploadError",C(e),t,n,o)}(e,n.status,n.statusText,n.responseText,t)},e.onLoadEnd=function(){!function(e,t){L("FileUploaded",e,t)}(e,t)}}(e,o),function(e){return e.chunkSize>0?k:x}(t).upload(e,t,(function(e){e.loadEnd(),e.isUploadComplete()||e.status!==l||b(e,t,n,o)})))}const k={upload:function(e,t,n){if(!e)return;e.totalChunkCount||(e.chunkIndex=0,e.totalChunkCount=function(e,t){let n=Math.trunc(e/t.chunkSize);return e%t.chunkSize>0&&n++,n}(e.fileInfo.size,t));const o=t.chunkSize*e.chunkIndex,i=e.value.slice(o,o+t.chunkSize),s=function(e,t,n){const o=new window.FormData;return o.append(e,t),o.append("chunkMetadata",JSON.stringify({FileName:n.fileInfo.name,FileSize:n.fileInfo.size,FileType:n.fileInfo.type,LastModified:n.fileInfo.lastModified,FileGuid:n.fileInfo.guid,Index:n.chunkIndex,TotalCount:n.totalChunkCount})),o}(t.name,i,e);e.request=M.sendRequest(s,{url:t.uploadUrl,method:"POST",headers:[],onAbort:function(t){e.abort()},onProgress:function(e){},onError:function(t){e.error(t.target)},onLoadStart:function(t){e.loadStart()},onLoad:function(t){200===t.target.status?(e.chunkIndex++,e.loadedBytes+=i.size,e.progress(),n(e)):e.error(t.target)}})}},x={upload:function(e,t,n){if(!e)return;const o=function(e,t){const n=new window.FormData;return n.append(e,t.value),n}(t.name,e);e.request=M.sendRequest(o,{url:t.uploadUrl,method:"POST",headers:[],onProgress:function(t){e.loadedBytes=t.loaded>e.fileInfo.size?e.fileInfo.size:t.loaded,e.progress()},onAbort:function(t){e.abort()},onError:function(t){e.error(t.target)},onLoadStart:function(t){e.loadStart()},onLoad:function(t){200===t.target.status?n(e,t):e.error(t.target)}})}},M={sendRequest:function(e,t,n){const o=new window.XMLHttpRequest;t.crossDomain=function(e){let t=!1;const n=document.createElement("a"),o=document.createElement("a");n.href=window.location.href;try{o.href=e,o.href=o.href,t=n.protocol+"//"+n.host!=o.protocol+"//"+o.host}catch(e){t=!0}return t}(t.url);const i=function(e){const t=e.headers||{};return t.Accept=t.Accept||"*/*",e.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t}(t);o.open(t.method,t.url,!0),t.onLoadStart&&(o.upload.onloadstart=t.onLoadStart),t.onLoad&&(o.onload=t.onLoad),t.onLoadEnd&&(o.upload.onloadend=t.onLoadEnd),t.onProgress&&(o.upload.onprogress=t.onProgress),t.onError&&(o.upload.onerror=t.onError),t.onAbort&&(o.upload.onabort=t.onAbort);for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&i[e]&&o.setRequestHeader(e,i[e]);return o.send(e),{abort:function(){o.abort()}}}};function v(e,t){t.invokeMethodAsync("SelectedFilesChanged",e.map((function(e){return C(e)})))}function L(e,t,n){n.invokeMethodAsync(e,C(t))}function C(e){return{Name:e.fileInfo.name,Size:e.fileInfo.size,Type:e.fileInfo.type,LastModified:e.fileInfo.lastModified,Guid:e.fileInfo.guid,LoadedBytes:e.loadedBytes,Status:e.status,IsFileExtensionValid:e.isFileExtensionValid,IsMinSizeValid:e.isMinSizeValid,IsMaxSizeValid:e.isMaxSizeValid}}function w(e,t,n,o){e.files.forEach((function(i){t.forEach((function(t){i.fileInfo.guid===t&&(i.status=u,b(i,n,e,o))}))}))}function A(e,t,n,o){e.files.forEach((function(e){t.forEach((function(t){e.fileInfo.guid===t&&e.pause()}))}))}function P(e,t,n,o){e.files.forEach((function(e){t.forEach((function(t){e.fileInfo.guid===t&&e.abort()}))}))}function V(e,t,n,o){const i=e.files.filter((function(e){return t.indexOf(e.fileInfo.guid)>-1}));0!==!i.length&&(e.files=U(e.files,t),g(i.map((function(e){return e.value})),o,n).then((function(i){e.files=e.files.concat(i),function(e,t,n){n.invokeMethodAsync("FileReloaded",e,t)}(t,i.map((function(e){return e.fileInfo.guid})),o),i.forEach((function(t){t.status=u,b(t,n,e,o)}))})))}function q(e,t,n,o){e.files=U(e.files,t),v(e.files,o)}function U(e,t){return e.filter((function(e){return-1===t.indexOf(e.fileInfo.guid)}))}function O(t){if(t=e(t))return s(t),Promise.resolve("ok")}const R={init:m,dispose:O,startFileUpload:w,pauseFileUpload:A,abortFileUpload:P,removeFiles:q,reloadFile:V};export default R;export{P as abortFileUpload,O as dispose,m as init,A as pauseFileUpload,V as reloadFile,q as removeFiles,w as startFileUpload};
