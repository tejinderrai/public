import"./esm-chunk-d81494b9.js";import{RequestAnimationFrame as t}from"./esm-dom-utils-88a2c0cb.js";import{K as e}from"./esm-chunk-54fd5426.js";import{E as i,S as s,a as n}from"./esm-chunk-4bcd729b.js";function l(t){return t*(2-t)}function o(t){return t/Math.abs(t)}function r(t,e,i,s){let n=null;function l(t){return n?n(t):0}function o(){n=null}function r(t,s,l){n=function(t,e,i,s,n){const l=e+i;let o=0;return function(r,a){if(a)return a(t-o,r,s(r/l));r>=l&&n&&n();const h=t*s((Math.min(r,l)-e)/i)-o;return o+=h,h}}(s+t,l,e,i,o)}function a(t){null===n?(r(t.value,0,t.timeStamp),s(l)):n(t.timeStamp,(e,i)=>r(t.value,e,i))}return t.subscribe(a),function(){n=null,t.unsubscribe(a)}}function a(e,s,n,l,a){r(function(t,e){const s=new i;let n=0,l=1;return t.subscribe(t=>{(0===n||t.timeStamp>=n||o(t.value)!==l)&&(n=t.timeStamp+e,l=o(t.value),s.emit(t))}),s}(function(t,e,s){const n=new i;return t.addEventListener(e,t=>{t.preventDefault();const e=s(t);0===e||isNaN(e)||n.emit({value:e,timeStamp:t.timeStamp})},!1),n}(e,"wheel",t=>o(t.deltaY)*s),30),300,n,(function(e){a(new Promise((i,s)=>{!function e(i,s){t(t=>{const n=i(t);0!==n?(l(n),e(i,s)):s()})}(e,i)}))}))}function h(t,e,i){const s=i(t);return s?e||s.visible.value?s:h(s,e,i):null}function c(t,e){const i=-1===e?"prevItem":"nextItem";return t[i]?t[i]:t[i]=function(i){const s=t.value+e*i.delta;return-1===e&&-1!==i.min&&s<i.min?new u(i,i.max,!1,null,t):1===e&&-1!==i.max&&s>i.max?new u(i,i.min,!1,t,null):new u(i,s,!1)}(t.collection)}class m{constructor(t,e,i,n,l,o){this.collection=t,this.prevItem=l,this.nextItem=o,this.value=e,this.visible=i||new s(!0),this.selected=new s(!!n),l&&(l.nextItem=this),o&&(o.prevItem=this),this.displayText=new s(e);const r=this.collection.selectedItem;this.selected.subscribe(t=>{t&&(r.value&&r.value.selected.update(!1),r.update(this))}),this.visible.subscribe(t=>{!t&&this.selected.value&&this.getPrevious().selected.update(!0),this.collection.visibleItemsChanged.emit()},!0)}getPrevious(t){return h(this,t,t=>t.prevItem)}getNext(t){return h(this,t,t=>t.nextItem)}getDisplayText(){return this.displayText.value||this.value}}class u extends m{constructor(t,e,i,s,n){super(t,e,null,i,s,n)}getPrevious(t){return c(this,-1)}getNext(t){return c(this,1)}}class d extends u{constructor(t,e){super(t,e,!0)}}class p{constructor(){this.items=[],this.selectedItem=new s,this.visibleItemsChanged=new i}static createMonthCollection(t,e){const i=new p;for(let s=0;s<e.length;s++)i.add(s+1,null,s+1===t).displayText.value=e[s];return i.initialize(t),i}static createGenerator(t,e,i,s){const n=new v(e,i,s);return n.initialize(t),n}initialize(t){this.items[0].prevItem=this.items[this.items.length-1],this.items[this.items.length-1].nextItem=this.items[0],this.items.filter(e=>e.value===t)[0].selected.update(!0)}add(t,e,i){const s=new m(this,t,e,i,this.items[this.items.length-1]);return this.items.push(s),s}}class v extends p{constructor(t,e,i){super(),this.min=t,this.max=e,this.delta=i,this.originItem=null}initialize(t){this.originItem=new d(this,t)}}class f{constructor(t,e,i,s,n){this.displayTextSubscription=this.displayTextSubscription.bind(this),this.roller=i,this.prevItem=n,this.nextItem=null,this.index=e,this.elements=i.createRollerItemElements(),this.offset=e*s,this.height=s,this.position=0,this.visibleItemCount=i.visibleItemCount,n&&(n.nextItem=this),this.updateDataItem(t),this.selectItem=this.selectItem.bind(this)}initialize(e){const i=Math.floor(this.visibleItemCount/2);this.elements[1].style.top=(this.index-i)*this.height+"px",e.appendChild(this.elements[1]),this.move(this.offset),this.elements[0].addEventListener("click",e=>{t(this.selectItem)})}isSelected(){return Math.floor(this.visibleItemCount/2)*this.height===Math.round(this.position)}selectItem(e){const i=Math.floor(this.visibleItemCount/2);return this.roller.afterMove(x(n.Empty,t=>this.roller.move(t),{divisor:this.roller.itemSize.height,startTimestamp:e,endTimestamp:e+300,easing:l,frameCallback:t,value:(i-this.index)*this.height-(this.position-this.offset)}))}move(t){this.updatePosition(t);const e=this.position-this.offset;this.elements.forEach(t=>t.style.transform="matrix(1, 0, 0, 1, 0, "+e+")")}updatePosition(t){this.position+=t,this.position>this.visibleItemCount*this.height?(this.position-=(this.visibleItemCount+1)*this.height,this.updateDataItem(this.nextItem.dataItem.getPrevious())):this.position<-1*this.height&&(this.position+=(this.visibleItemCount+1)*this.height,this.updateDataItem(this.prevItem.dataItem.getNext()))}updateDataItem(t){this.dataItem!==t&&(this.dataItem&&this.dataItem.displayText.unsubscribe(this.displayTextSubscription),this.dataItem=t,this.dataItem.displayText.subscribe(this.displayTextSubscription))}displayTextSubscription(t){this.elements.forEach(e=>b(e,t))}raiseChanges(){this.isSelected()&&this.dataItem.selected.update(!0)}}function b(t,e){t.innerText=e}function g(t,e,i){const s=i(t);return Math.abs(Math.round(s.position-t.position))===e?[s].concat(g(s,e,i)):[]}function I(t,e,i){0!==t.length&&(t.shift().updateDataItem(e),I(t,i(e),i))}class C{constructor(t,e,i,s,n,l){this.itemCollection=t,this.visibleItemCount=e,this.itemContainers=[],this.itemSize=s,this.caption=n,this.longestVisibleDisplayText=l,this.container=i,this.rollerElement=null,this.rollerContainer=null,this.move=this.move.bind(this),this.afterMove=this.afterMove.bind(this)}initialize(){this.initializeRollerElements();const s=[this.itemCollection.selectedItem.value];for(;s.length<this.visibleItemCount;)s.splice(0,0,s[0].getPrevious()),s.push(s[s.length-1].getNext());s.push(s[s.length-1].getNext());for(let t=0;t<s.length;t++)this.itemContainers.push(new f(s[t],t,this,this.itemSize.height,this.itemContainers[this.itemContainers.length-1]));this.longestVisibleDisplayText&&b(this.createRollerItemElement("roller-item expander"),this.longestVisibleDisplayText);const n=this.createRollerItemElement("roller-after");this.itemContainers[0].prevItem=this.itemContainers[this.itemContainers.length-1],this.itemContainers[this.itemContainers.length-1].nextItem=this.itemContainers[0];for(let t=0;t<this.itemContainers.length;t++)this.itemContainers[t].initialize(n);this.itemCollection.selectedItem.subscribe(()=>this.updateVisibleDataItems(),!0),this.itemCollection.visibleItemsChanged.subscribe(()=>this.updateVisibleDataItems(),!0),a(this.rollerElement,this.itemSize.height,l,this.move,this.afterMove),function(e,s,n,l){const o=new i,r=new i;let a=0;e.addEventListener("touchstart",(function(t){a=t.touches[0].clientY}),!1),e.addEventListener("touchend",(function(e){a=0,t(t=>r.emit(t))}),!1),e.addEventListener("touchmove",(function(t){t.preventDefault();const e=t.changedTouches[0].clientY;o.emit(e-a),a=e}),!1),w(o,r,{divisor:s},n,l,t)}(this.rollerElement,this.itemSize.height,this.move,this.afterMove),this.rollerContainer.addEventListener("keydown",t=>{let i=null;t.keyCode===e.Up?i=this.itemCollection.selectedItem.value.getNext():t.keyCode===e.Down&&(i=this.itemCollection.selectedItem.value.getPrevious()),i&&(t.preventDefault(),i.selected.update(!0))})}initializeRollerElements(){const t=this.rollerContainer=document.createElement("A");t.className="roller-container",t.href="javascript:;",t.style.minWidth=this.itemSize.width;const e=document.createElement("SPAN");e.innerText=this.caption,e.className="roller-title",t.appendChild(e);const i=this.rollerElement=document.createElement("SPAN");i.className="roller",t.appendChild(i),this.container&&this.container.appendChild(t)}updateVisibleDataItems(){const t=this.itemContainers.filter(t=>t.isSelected())[0];if(!t)return;const e=g(t,this.itemSize.height,t=>t.prevItem),i=g(t,this.itemSize.height,t=>t.nextItem),s=this.itemCollection.selectedItem.value;t.updateDataItem(s),I(e.concat([]),s.getPrevious(),t=>t.getPrevious()),I(i.concat([]),s.getNext(),t=>t.getNext())}createRollerItemElement(t){const e=document.createElement("SPAN");return e.className=t||"roller-item",this.rollerElement.appendChild(e),e}createRollerItemElements(){const t=this.createRollerItemElement();return[t,t.cloneNode()]}move(t){if(0===t)return;const e=Math.sign(t),i=this.itemContainers.length-1,s=(-1===e?0:i)+e;for(let n=-1===e?i:0;n!==s;n+=e)this.itemContainers[n].move(t)}afterMove(t){return t.then(()=>Promise.resolve(this.itemContainers.forEach(t=>t.raiseChanges())))}}function x(t,e,i){return new Promise((s,n)=>{function l(){t.unsubscribe(l),n()}t.subscribe(l,!0);let o=0;const r=i.frameCallback;r((function n(a){if(a<i.endTimestamp){const t=i.easing((a-i.startTimestamp)/(i.endTimestamp-i.startTimestamp)),s=i.value*t-o;e(s),o+=s,r(n)}else t.unsubscribe(l),e(i.value-o),s()}))})}function w(t,e,i,s,n,o){let r,a,h,c,m=1;const u=i.accelerationTimeFrame||300;function d(t){a=0,h=t,m=1}t.subscribe((function(p){o(v=>{c||(c=!0,d(v),n(new Promise((n,r)=>{e.subscribe((function r(h){e.unsubscribe(r),x(t,s,function(t){const e=Math.abs(a%i.divisor);return{value:(i.divisor-e)*Math.sign(a),endTimestamp:t+300,startTimestamp:t,easing:l,frameCallback:o}}(h)).then(()=>{c=!1,n()}).catch(()=>{e.subscribe(r)}).finally(d)}))}))),s(function(t,e){return(e*=m)>=r&&t-h<=u&&(m=Math.min(2,1.2*m)),a+=e,r=e,h=t,e}(v,p))})}))}function y(t){return t.value%4==0&&t.value%100!=0||t.value%400==0}function T(t){return 2!==t.value}function E(t){return-1!==[1,3,5,7,8,10,12].indexOf(t.value)}const S=0,D=1,z=2,M=3,N=4,P=5;function k(t,e,i,s,n,l){const o=t.add(e,i,s);n.length>0&&l.subscribe(([t,i])=>{const s=n[R(i.value,t.value,e)];o.displayText.update(e+" "+s)})}function R(t,e,i){return new Date(t,e-1,i).getDay()}function L(t){return t&&t.length?" "+t.concat([]).sort((t,e)=>e.length-t.length)[0]:""}const j={initializeDateRoller:function(t,e,i,s,n){let l=e.items.filter(t=>t.type===D||t.type===z||t.type===S)[0],o=e.items.filter(t=>t.type===M||t.type===N)[0],r=e.items.filter(t=>t.type===P)[0],a=e.monthNames||[];const h=e.dayNames||[];l=void 0!==l?l.value:1,void 0===o?(a=["","","","","","","","","","","",""],o=i):o=o.value,r=void 0===r?s:r.value;const c=p.createGenerator(r,-1,-1,1),m=p.createMonthCollection(o,a),u=m.selectedItem.asTrigger(T),d={29:c.selectedItem.asTrigger(y).or(u),30:u,31:m.selectedItem.asTrigger(E)},v=m.selectedItem.join(c.selectedItem),f=new p;for(let t=1;t<=31;t++)k(f,t,d[t],t===l,h,v);f.initialize(l);const b=document.createDocumentFragment(),g=document.createElement("STYLE");function I(t){return function(e){t(e),n.invokeMethodAsync("UpdateDateTime",[l,o,r])}}return g.type="text/css",g.innerText=".roller { height: 180px; } .roller-item, .roller-after { height: 36px; } .roller-item, .roller-title { color: "+window.getComputedStyle(t).color+" !important; } .roller-after { background-color: "+window.getComputedStyle(t.parentNode.parentNode).backgroundColor+";}",b.appendChild(g),e.items.forEach(t=>{switch(t.type){case S:case z:case D:new C(f,5,b,{width:"",height:36},"Day","25"+L(h)).initialize();break;case N:case M:new C(m,5,b,{width:"",height:36},"Month",L(a)).initialize();break;case P:new C(c,5,b,{width:"",height:36},"Year","0000").initialize()}}),t.appendChild(b),f.selectedItem.subscribe(I(t=>{l=t.value})),m.selectedItem.subscribe(I(t=>{o=t.value})),c.selectedItem.subscribe(I(t=>{r=t.value})),Promise.resolve()}};export default j;export{C as Roller,m as RollerItem,p as RollerItemCollection,w as attachInputSource,R as getDayOfWeek};
