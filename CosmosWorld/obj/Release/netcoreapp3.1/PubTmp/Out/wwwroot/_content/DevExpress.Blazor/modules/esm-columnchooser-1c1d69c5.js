import"./esm-chunk-d81494b9.js";import{ensureElement as n,eraseBlazorIdentificators as t}from"./esm-dom-utils-88a2c0cb.js";import"./esm-chunk-639f7231.js";import{E as e}from"./esm-chunk-5d9ef2cd.js";import{FocusUnit as o,DragAndDropUnit as c,getClientRect as s,RectBlz as i}from"./esm-dragAndDropUnit-ce1d0bbc.js";let u,r,l,a,d,f,m,p,h,g,w=null,v=-1,y=-1,x=!0,E=!1;function b(t,o,c,s){if(t.forEach((function(t){n(t)})),a?a._id!==s._id&&(U(a),a=s):a=s,!p){p=o;let n=p;for(;n.parentNode!==document&&n.classList;){if(n.classList.contains("modal-body")){E=!0;break}n=n.parentNode}}if(d=new Map,f&&f.dispose(),f=new e(p),w||(r=new Map,l=new Map,w=t),y=-1,f.attachEventWithContext(document,"keydown",N,document),w&&(w.sort((function(n,t){return n.dataset.vindex-t.dataset.vindex})),h=function(n,t){if(E)return n;let e=n,o=window.getComputedStyle(e);for(;o.position!==t&&e.parentNode!==document;)e=e.parentNode,o=window.getComputedStyle(e);return e}(p,"absolute"),L(c&&!E),k())){const n=f.attachEvent(h,"focusin",(function(){n.dispose(),w[0].focus()}))}z(),g&&(g.parentNode.removeChild(g),g=null)}function L(n){x=n,m&&m.dispose();const t=document.querySelector(".column-chooser-exit-button");m=t?new o(t,null,p,!x):null,l.forEach((function(n){n.dispose()})),l=new Map,w.forEach((function(n){!function(n,t){let e=r.get(n.dataset.column);e||(e=new c(n,n.parentNode,S,".column-chooser-drag-icon-owner",B,E),e.onDragStart=_,e.onDrag=R,e.onDragCancel=q,e.onDropAnimationEnd=T,r.set(n.dataset.column,e));e.reset(),n.classList.remove("up"),n.classList.remove("down"),n.classList.remove("freeze");let s=l.get(n.dataset.column);s||(s=new o(n,".custom-control-input",t,E||!x),s.onFocus=D,s.onBlur=O,s.onClick=j,l.set(n.dataset.column,s));s.reset()}(n,h)}))}function k(){return x}function N(n){switch(k()||(L(!0),9===n.keyCode&&w[w.length-1].focus()),n.keyCode){case 32:y>=0&&(n.preventDefault(),w[y].click());break;case 38:n.preventDefault(),C(-1);break;case 40:n.preventDefault(),C(1)}}function C(n){if(!w||!r)return;y+=n,y=y<0?w.length-1:y,y%=w.length;const t=l.get(w[y].dataset.column);t&&t.focus()}function D(n){y=w.indexOf(n)}function O(n){y===w.indexOf(n)&&(y===w.length-1&&m&&m.focus(),y=-1)}function j(n){k()&&L(!1)}function M(n){return w.find((function(t,e,o){return function(n,t){const e=A(n);return!!e&&(e.top<=t&&t<=e.bottom)}(t,n.y)}))}function S(n){const t=M(n);return t?{item:t,relativeRect:A(t)}:null}function z(){if(u&&u.style){const n=r.get(u.dataset.column);n&&n.reset();const t=l.get(u.dataset.column);t&&t.reset(),v=-1,u.childNodes.forEach((function(n){n.style&&(n.style.visibility="")})),u=null}}function _(n){u=n,v=w.indexOf(u),w.forEach((function(n){n.blur(),n!==u&&n.classList.add("freeze")})),u.childNodes.forEach((function(n){n.style&&(n.style.visibility="hidden")}));const t=l.get(u.dataset.column);t&&t.stop()}function A(n){let t=d.get(n);if(t)return t;const e=s(n),o=B();return t=new i(e.x-o.x,e.y-o.y,e.width,e.height),d.set(n,t),t}function T(n,e){w.forEach((function(n){r.get(n.dataset.column).stop()})),g=p.cloneNode(!0),t(g),g.style["z-index"]=2e3,p.parentNode.appendChild(g),a.invokeMethodAsync("OnElementsExchange",n.dataset.column,e.dataset.column).catch((function(n){window.console.error(n)}))}function q(n){w.forEach((function(n){n.classList.remove("up"),n.classList.remove("down"),n.classList.remove("freeze")})),z()}function B(){const n=E?p.parentNode:p,t=s(n);return 0!==n.scrollTop?{x:t.x,y:t.y-n.scrollTop}:t.location}function F(n){l.get(n.dataset.column).updateStyleMetadata()}function R(n,t){if(!n)return;-1===v&&(v=w.indexOf(n));const e=M(t.centerOfDraggingObject);if(!e)return;const o=w.indexOf(e);let c=!1;w.forEach(v<o?function(n){u===n&&(c=!0),c?(F(n),n.classList.add("up")):n.classList.remove("up","down"),e===n&&(c=!1)}:v>o?function(n){e===n&&(c=!0),c?(F(n),n.classList.add("down")):n.classList.remove("up","down"),u===n&&(c=!1)}:function(n){n.classList.remove("up","down")})}function U(n){n._id===a._id&&(r.forEach((function(n){n.dispose()})),l.forEach((function(n){n.dispose()})),w=null,u=null,v=-1,p=null,d=null,r=null,l=null,a=null,f&&f.dispose(),f=null,g&&(g.parentNode.removeChild(g),g=null))}const W={init:b,dispose:U};export default W;export{U as dispose,b as init};
