import{B as e}from"./esm-chunk-d81494b9.js";import{attachEventToElement as t,detachEventFromElement as o,findParentBySelector as l,getParentByClassName as n,getDocumentScrollTop as i,getDocumentScrollLeft as r,elementIsInDOM as s,querySelectorFromRoot as c,ensureElement as u,getLeftRightBordersAndPaddingsSummaryValue as d,getCurrentStyleSheet as a,subscribeElementContentSize as f,getTopBottomBordersAndPaddingsSummaryValue as p,unsubscribeElement as g,getEventSource as h}from"./esm-dom-utils-88a2c0cb.js";import{d as m,r as y}from"./esm-chunk-fc46b9cc.js";import{T as H}from"./esm-chunk-639f7231.js";import{g as S}from"./esm-chunk-13e2cf5f.js";const x=".dxbs-table td.table-active",T=".dropdown-item.active",b=".dropdown-item.focused",w={GroupPanelHead:"gph",ColumnHead:"ch"};function v(e){if(!e.hasAttribute("data-dxdg-draggable"))return null;const t=e.getAttribute("data-dxdg-draggable").split("|"),o=!(t.length>2)||"1"===t[2],l=t.length>1?w[t[1]]:w.ColumnHead,n=l===w.ColumnHead?parseInt(t[0]):-1,i=l===w.GroupPanelHead?parseInt(t[0]):-1,r=e.previousElementSibling;return{columnVisibleIndex:n,groupVisibleIndex:i,columnHeadType:l,canBeGrouped:o,needInsertBeforeToo:!r||!v(r),element:e}}function I(e){return"[data-dxdg-draggable-id="+e+"]"}function R(e,t,o){var l,n,i;l=e,n=N(t,"clientX")-o.left,i=N(t,"clientY")-o.top,void(l.style.transform=["translate(",Math.round(n),"px, ",Math.round(i),"px)"].join(""))}function N(e,t){return void 0!==e[t]?e[t]:void 0!==e.touches?e.touches[0][t]:0}function E(s,c,u){const d=N(s,"clientX"),a=N(s,"clientY"),f=s.target;let p=!1;const g=function(e){const s=Math.abs(d-N(e,"clientX"))>10,g=Math.abs(a-N(e,"clientY"))>10;return(s||g)&&(p=!0,h(),function(e,s,c,u){const d=I(c),a=l(s,d);if(!a)return;const f=n(a,"dxbs-gridview").getBoundingClientRect(),p=v(a),g=r(),h=i();let m={left:0,top:0};const y=function(e,t){const o=[],l=I(t),n=document.querySelectorAll(l);let i=!1,r=!1;for(let e=0;e<n.length;e++){const t=n[e],l=t.getBoundingClientRect(),s=v(t),c=s.columnVisibleIndex,u=s.groupVisibleIndex,d=s.columnHeadType;d===w.GroupPanelHead?i=!0:d===w.ColumnHead&&(r=!0),s.needInsertBeforeToo&&o.push(new q(t,l.left,l.top,l.bottom,c,u,d,!0,!1)),o.push(new q(t,l.right,l.top,l.bottom,c,u,d,!1,!1))}if(i||r){if(!i){const e=document.querySelector("[data-dxdg-drag-group-panel="+t+"]");if(e){const t=e.getBoundingClientRect();o.push(new q(e,t.left,t.top,t.bottom,-1,0,w.GroupPanelHead,!1,!0,!0))}}if(!r){const e=document.querySelector("[data-dxdg-drag-head-row="+t+"]");if(e){const t=e.getBoundingClientRect();o.push(new q(e,t.right,t.top,t.bottom,-1,-1,w.ColumnHead,!1,!0,!0))}}}return o}(0,c),S=function(e,t){let o=e.cloneNode(!0);const l=e.getBoundingClientRect(),n={left:N(t,"clientX")-l.left,top:N(t,"clientY")-l.top};if("DIV"!==o.tagName){const t=document.createElement("DIV"),n=window.getComputedStyle(e);t.innerHTML=o.innerHTML,t.className="card "+e.className,t.style.width=l.width+"px",t.style.height=l.height+"px",t.style.paddingTop=n.paddingTop,t.style.paddingBottom=n.paddingBottom,t.style.paddingLeft=n.paddingLeft,t.style.paddingRight=n.paddingRight,o=t}else o.style.width=l.width+"px",o.style.height=l.height+"px";o.className=o.className+" dx-dragging-state",document.body.appendChild(o);const i=o.getBoundingClientRect();return{dragElement:o,offsetFromMouse:{left:i.left+n.left,top:i.top+n.top}}}(a,e),x=S.dragElement,T=S.offsetFromMouse;R(x,e,T);let b=!0,E=null;const M=function(e){return b&&(x.style.visibility="visible",b=!1),R(x,e,{left:T.left+m.left,top:T.top+m.top}),E=function(e,t,o,l,n,s){!function(e){const t=I(e),o=document.querySelectorAll("div.dxgv-target-marks"+t);for(let e=0;e<o.length;e++){const t=o[e];t.parentNode.removeChild(t)}}(t);let c=null;const u=[],d=N(l,"clientX"),a=N(l,"clientY");for(let t=0;t<e.length;t++){const l=e[t];if((l.columnHeadType!==w.GroupPanelHead||o.canBeGrouped)&&(l.top+n.top<=a&&a<=l.bottom+n.top)){if(l.wholeRowIsRarget){c=l;break}u.push({distance:Math.abs(Math.abs(l.x+n.left)-Math.abs(d)),target:l})}}if(null==c){let e=1e6;for(const t in u)e>u[t].distance&&V(d,o,u[t].target)&&(e=u[t].distance,c=u[t].target)}null==c||B(o,c)||c.x>=s.left&&c.x<=s.right&&!function(e,t){const o=document.createElement("DIV");o.className="dxgv-target-marks",o.dataset.dxdgDraggableId=t,o.style.top=e.top+(e.docScrollTop-i())+i()-1-1+"px",o.style.height=e.bottom-e.top+2+"px",o.style.left=e.x+(e.docScrollLeft-r())+r()+"px",o.innerHTML=["<span class='oi oi-arrow-bottom' aria-hidden='true'></span>","<div style='height:",o.style.height,"'></div>","<span class='oi oi-arrow-top' aria-hidden='true'></span>"].join(""),document.body.appendChild(o),e.mark=o}(c,t);return c}(y,c,p,e,m,f),e.preventDefault(),!1},C=function(){if(E&&!B(p,E)){u.invokeMethodAsync("OnGridColumnHeadDragNDrop",p.columnHeadType===w.GroupPanelHead?p.groupVisibleIndex:p.columnVisibleIndex,p.columnHeadType,E.columnHeadType===w.GroupPanelHead?E.groupVisibleIndex:E.columnVisibleIndex,E.columnHeadType,E.insertBefore),E.mark&&E.mark.parentNode.removeChild(E.mark)}o(document,H.touchMouseMoveEventName,M),o(document,H.touchMouseUpEventName,C),o(window,"scroll",L),x.parentNode.removeChild(x)},L=function(){m={left:g-r(),top:h-i()}};t(document,H.touchMouseMoveEventName,M),t(document,H.touchMouseUpEventName,C),t(window,"scroll",L)}(e,f,c,u)),e.preventDefault(),!1},h=function(){o(document,H.touchMouseMoveEventName,g),o(document,H.touchMouseUpEventName,h),!p&&f&&e.WebKitTouchUI&&f.click()};return t(document,H.touchMouseMoveEventName,g),t(document,H.touchMouseUpEventName,h),s.preventDefault(),f.focus(),!1}function q(e,t,o,l,n,s,c,u,d){this.element=e,this.x=t,this.top=o,this.bottom=l,this.columnVisibleIndex=n,this.groupVisibleIndex=s,this.columnHeadType=c,this.insertBefore=u,this.wholeRowIsRarget=d,this.docScrollTop=i(),this.docScrollLeft=r()}function B(e,t){function o(e,t){return t.groupVisibleIndex===e.groupVisibleIndex||t.groupVisibleIndex===e.groupVisibleIndex-1&&!t.insertBefore}function l(e,t){return t.columnVisibleIndex===e.columnVisibleIndex||t.columnVisibleIndex===e.columnVisibleIndex-1&&!t.insertBefore}return!(t.columnHeadType!==e.columnHeadType||e.columnHeadType!==w.GroupPanelHead||!o(e,t))||(!(t.columnHeadType!==e.columnHeadType||e.columnHeadType!==w.ColumnHead||!l(e,t))||(!(e.columnHeadType!==w.GroupPanelHead||t.columnHeadType!==w.ColumnHead||-1===e.columnVisibleIndex||!l(e,t))||!(e.columnHeadType!==w.ColumnHead||t.columnHeadType!==w.GroupPanelHead||-1===e.groupVisibleIndex||!o(e,t))))}function V(e,t,o){const l=t.element.getBoundingClientRect();if(B(t,o)&&(e<l.left||e>l.right))return!1;if(o.x<l.left){if(e>l.right)return!1}else if(e<l.left)return!1;return!0}w[1]=w.ColumnHead,w[0]=w.GroupPanelHead;class M{constructor(e,t,o){this._itemHeight=e,this._scrollTop=t,this._scrollHeight=o}get itemHeight(){return this._itemHeight}get scrollTop(){return this._scrollTop}get scrollHeight(){return this._scrollHeight}isEqual(e){return this.itemHeight===e.itemHeight&&this.scrollTop===e.scrollTop&&this.scrollHeight===e.scrollHeight}}function C(e){if(!s(e))return;let t=function(e){let t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){let e=t.querySelector(T);if(e||(e=t.querySelector(x)),e)return e.parentNode}return null}(e);if(t||(t=function(e){let t=null;c(e,(function(o){t=e.querySelector("*"+o+" > *[id$='_LB']")})),t||c(e.parentNode,(function(o){t=e.parentNode.querySelector("*"+o+" > *[id$='_LB']")}));const o=t?t.querySelector(x):null;return o?o.parentNode:null}(e)),t){const o=e;let l=t.offsetTop;if("TABLE"===t.offsetParent.tagName){const e=t.offsetParent.previousElementSibling;e&&(l+=e.clientHeight)}const n=o.scrollTop+o.clientHeight<l+t.offsetHeight;o.scrollTop>l&&(o.scrollTop=l),n&&(o.scrollTop=l-(o.clientHeight-t.offsetHeight))}}function L(e){if(!s(e))return;const t=function(e){let t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){const e=t.querySelector(b);if(e)return"TR"===e.tagName?e:e.parentNode}return null}(e);if(t){let o=e.querySelector(".dxgvCSD");o||(o=e);const l=o.scrollTop+o.clientHeight<t.offsetTop+t.offsetHeight;o.scrollTop>t.offsetTop&&(o.scrollTop=t.offsetTop),l&&(o.scrollTop=t.offsetTop-(o.clientHeight-t.offsetHeight))}}function D(e){void 0===e.dataset.virtualScrollLock&&(e.dataset.virtualScrollLock=0)}function k(e){D(e),e.dataset.virtualScrollLock++}function A(e){D(e),e.dataset.virtualScrollLock--}function W(e,t,o,l,n,i,r){o.isHorizontalScrolling&&!function(e,t,o){if(t.scrollLeft===o.scrollLeft)return;const l=h(e);l===t?o.scrollLeft=t.scrollLeft:l===o&&setTimeout(()=>t.scrollLeft=o.scrollLeft,0)}(e,l,n),o.isVirtualScrolling&&function(e,t,o,l,n){if(i=o,D(i),i.dataset.virtualScrollLock>0)return;var i;!function(e,t,o,l,n){let i=!0;o.dataset.prevScrollTop?i=o.dataset.prevScrollTop!==o.scrollTop.toString():o.dataset.prevScrollTop=o.scrollTop;G(o),i&&(o.dataset.OnScrollTimerId=setTimeout((function(){!function(e,t,o,l,n){const i=P(t),r=U(t,n),s=r.scrollTop,c=r.scrollBottom,u=l.clientHeight>0&&c>o.offsetHeight+i.offsetHeight;(o.clientHeight>0&&s<o.offsetHeight||u)&&!function(e,t,o){if(e.dxScrollStateCache&&e.dxScrollStateCache.isEqual(o))return;e.dxScrollStateCache=o,t.DxRestoreScrollTop=t.scrollTop,k(t),e.invokeMethodAsync("OnGridVirtualScroll",o.itemHeight,o.scrollTop,o.scrollHeight).then(o=>{!function(e,t){J(e.mainElement,e,t)}(o,e),A(t)}).catch(z)}(e,t,r.requestScrollState)}(e,o,l,n,!1),t.needInternalSettings&&$(t)}),200))}(e,t,o,l,n)}(t,o,l,i,r)}function G(e){e.dataset.OnScrollTimerId&&(clearTimeout(e.dataset.OnScrollTimerId),delete e.dataset.OnScrollTimerId)}function P(e){const t=e.querySelector("table.dxbs-table"),o=e.parentNode.querySelector("div.dxbs-listbox > ul");return t||o}function _(e,t,o,l,n){const i=P(t),r=function(e,t){const o=O(e);return{itemHeight:o,spacerTop:t.virtualScrollingOptions.itemsAbove*o,spacerBelow:t.virtualScrollingOptions.itemsBelow*o}}(i,n);o.style.height=r.spacerTop+"px",l.style.height=r.spacerBelow+"px",function(e,t,o,l){if(e.clientHeight>t.offsetHeight)return;e.scrollTop<o.clientHeight&&(e.scrollTop=o.clientHeight+1);e.scrollTop+e.clientHeight>o.clientHeight+t.offsetHeight&&(e.scrollTop=o.clientHeight+t.offsetHeight-e.clientHeight-1)}(t,i,o)}function O(e){const t=function(e){let t=[];return e.dataset.tempUniqueId="tempUniqueId","TABLE"===e.tagName?t=e.parentNode.querySelectorAll("TABLE[data-temp-unique-id] > TBODY > TR"):"UL"===e.tagName&&(t=e.parentNode.querySelectorAll("ul[data-temp-unique-id] > li")),delete e.dataset.tempUniqueId,t}(e),o={};for(let e=0;e<t.length;e++){const l=t[e];o[l.offsetHeight]=o[l.offsetHeight]?o[l.offsetHeight]+1:1}let l=0,n=0;for(const e in o)o[e]>n&&(n=o[e],l=e);return Number.parseInt(l)}function X(e){return null!==P(e)}function U(e,t){let o=300,l=300;t&&(o=0,l=0);const n=P(e);let i=e.scrollTop-o;i<0&&(i=0);const r=e.scrollTop+e.clientHeight+l;let s=i-o;s<0&&(s=0);const c=r-s+l,u=O(n);return{scrollTop:i,scrollBottom:r,requestScrollState:new M(u,s,c)}}function z(e){e&&e.mainElement&&Q(e.mainElement)}function j(e,t){return(t.isVerticalScrolling||t.isVirtualScrolling)&&(e.clientHeight<e.scrollHeight||"scroll"===e.style.overflowY)}function Y(e){return function(){if(!e.ownerStyleSheet)return;const t=e.parentStyleSheet,o=Array.prototype.indexOf.call(t.cssRules,e);o>-1&&t.deleteRule(o)}}function $(e){const t=e.elementsStorage,o=u(e.mainElement).parentElement;if(!o)return;const l=u(t.scrollElement),i=u(t.scrollHeaderElement),r=[],s=window.getComputedStyle(o);if(!l.style.maxHeight){if(!s)return;const t=parseInt(s.borderTopWidth,10)+parseInt(s.borderBottomWidth,10);if(e.isDropDown){const e=parseInt(s.maxHeight,10)-t;l.style.maxHeight=e-i.offsetHeight+"px"}else{const e=f(o,e=>{l.style.maxHeight=e.height-i.offsetHeight+"px"}),t=f(i,e=>{l.style.maxHeight=o.clientHeight-(e.height+2*p(i))+"px"});r.push((function(){g(e),g(t)})),l.style.maxHeight=o.clientHeight-i.offsetHeight+"px"}}function c(e,t){const o=e.querySelector(t);return o?o.children:null}let d=!0;if(o.dataset.calculated&&(d=e.isVirtualScrolling),d&&e.isDropDown&&2!==e.dropDownWidthMode){const t=l.querySelector("table"),d=i.querySelector("table");if(!t||!d)return;const f=c(t,"tbody>tr"),p=f&&1===f.length&&t.querySelector("tr.dxbs-empty-data-row"),g=c(d,"colgroup"),h=c(t,"colgroup");o.dataset.calculated&&K(g,h);let m=0;if(p)d.style.width="auto",t.style.width=window.getComputedStyle(d).width;else{const o=c(d,"thead>tr");if(!(g&&o&&f&&h))return;t.style.width=d.style.width="auto";const l=[];for(let t=0;t<g.length;t++)if(g[t].style.width)if(-1!==g[t].style.width.indexOf("%"))l.push(t);else{const o=a(),l=u(e.mainElement).getAttribute("data-dxdg-id");let n=null;o&&(o.insertRule("[data-dxdg-id='"+l+"'] table tr>td:nth-child("+(t+1)+"), [data-dxdg-id='"+l+"'] table tr>th:nth-child("+(t+1)+") { max-width:"+g[t].style.width+"; }",o.cssRules.length),n=o.cssRules[o.cssRules.length-1],m+=parseFloat(g[t].style.width,10)),r.push(Y(n))}else g[t].dataset.autoWidth=!0,m+=F(g[t],h[t],o[t],f[t]);if(l.length>0)for(let e=0;e<l.length;e++)m+=F(g[e],h[e],o[e],f[e]);t.removeAttribute("style"),d.removeAttribute("style")}if(0===e.dropDownWidthMode||1===e.dropDownWidthMode){const t=n(o,"dx-blazor-multicolumn-editor");if(!t)return;const l=parseInt(s.borderRightWidth,10)+parseInt(s.borderLeftWidth,10),i=m+S()+l;0===e.dropDownWidthMode&&t.offsetWidth>=i?(K(g,h),o.style.width=t.offsetWidth+"px"):o.style.width=i+"px"}o.dataset.calculated=!0}return r.length>0?function(){r.forEach(e=>e())}:null}function F(e,t,o,l){const n=o.offsetWidth,i=l.offsetWidth,r=n>i?n:i;return t.style.width=e.style.width=r+"px",r}function K(e,t){for(let o=0;o<e.length;o++)if(e[o].dataset.autoWidth&&(e[o].style.width=null,t)){const e=t.item(o);e&&(e.style.width=null)}}function J(e,l,n){const i=u(e);if(!i)return;const r=n,s=l.scrollToSelectedItemRequested,c=l.elementsStorage;let f=u(c.scrollElement),p=u(c.scrollHeaderElement),g=u(c.virtualScrollSpacerTopElement),h=u(c.virtualScrollSpacerBottomElement);m(i);let x=null,T=null,b=null,w=null,v=null;l.needInternalSettings&&(v=$(l)),f=u(f);let I=null;f&&(p=u(p),k(f),l.isVirtualScrolling&&(g=u(g),h=u(h)),(l.isVirtualScrolling||l.isVerticalScrolling)&&function(e,t,o){if(!o.isVerticalScrolling&&!o.isVirtualScrolling)return;if(!t)return;const l=[t];if(j(e,o)){const n=17,i=S();if(i!==n||o.isHorizontalScrolling){const e=o.isHorizontalScrolling?"paddingRight":"marginRight",t=o.isHorizontalScrolling?"marginRight":"paddingRight";for(let o=0,n=l.length;o<n;o++)l[o].style[e]="0",l[o].style[t]=i+"px"}else e.style.paddingRight="",e.style.marginRight="",t.style.paddingRight="",t.style.marginRight=""}else e.style.paddingRight="0",e.style.marginRight="0",t.style.paddingRight="0",t.style.marginRight="0"}(f,p,l),l.isVirtualScrolling&&(_(0,f,g,h,l),s?C(f):f.DxRestoreScrollTop&&(f.scrollTop=f.DxRestoreScrollTop,delete f.DxRestoreScrollTop)),I=function(e){const t=e.querySelectorAll(".btn.btn-toggle");let o=0;for(let e=0;e<t.length;e++){const l=t[e],n=l.offsetWidth+d(l.parentNode);if(n>0){o=n;break}}const l=a(),n=e.getAttribute("data-dxdg-id");let i=null;return l&&(l.insertRule("[data-dxdg-id='"+n+"'] > col.dxbs-grid-cols-togglebtn { width:"+o+"px !important; }",l.cssRules.length),i=l.cssRules[l.cssRules.length-1]),Y(i)}(i),x=function(e){return W(e,r,l,f,p,g,h)},t(f,"scroll",x),p&&t(p,"scroll",x),A(f),function(e){return!e.needInternalSettings&&(e.isHorizontalScrolling||e.isVerticalScrolling)}(l)&&(T=function(){!function(e,t,o,l,n,i){let r,s;t&&(k(t),r=t.style.overflowX,t.style.overflowX="hidden",t.style.width="0"),o&&(s=o.style.overflowX,o.style.overflowX="hidden",o.style.width="0");const c=e.clientWidth;if(t&&(c&&(t.style.width=c+"px"),t.style.overflowX=r),o){const e=j(t,i)?S():0;c&&(o.style.width=c-e+"px"),o.style.overflowX=s}t&&A(t)}(i,f,p,0,0,l)},T(),t(window,"resize",T)));let R=null,N=null;if(l.isColumnDragEnabled){const e=i.dataset.dxdgId;e&&(R=i.querySelector("[data-dxdg-drag-head-row='"+e+"']"),R&&(b=function(t){return E(t,e,r)},t(R,H.touchMouseDownEventName,b)),N=i.querySelector("[data-dxdg-gp='"+e+"']"),N&&(w=function(t){return E(t,e,r)},t(N,H.touchMouseDownEventName,w)))}return y(i,(function(){I&&I(),v&&v(),x&&(o(f,"scroll",W),p&&o(p,"scroll",W)),T&&o(window,"resize",T),f&&G(f),b&&R&&o(R,H.touchMouseDownEventName,b),w&&N&&o(N,H.touchMouseDownEventName,w)})),Promise.resolve("ok")}function Q(e){return(e=u(e))&&m(e),Promise.resolve("ok")}const Z={init:J,dispose:Q};export default Z;export{X as HasParametersForVirtualScrollingRequest,Q as dispose,U as getParametersForVirtualScrollingRequest,J as init,L as scrollToFocusedItem,C as scrollToSelectedItem};
